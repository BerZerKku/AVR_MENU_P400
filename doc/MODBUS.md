Авант Р400 - MODBUS 
===================

Описание работы протокола для версии МК ПИ 07.66.


# Настройка

Настройки интерфейса RS-485 фиксированные:
- Скорость связи: 19200 бит/с
- Количество байт данных: 8
- Проверка четности: нет
- Количество стоп бит: 2

Параметр *Общие / Сетевой адрес* приемопередатчика должен иметь уникальное, отличное от любого другого устройства в сети MODBUS значение в диапазоне от 1 до 247.

Параметр *Протокол / Протокол* должен иметь значение *MODBUS*. При установке данного значения связь автоматически переключается с RS-232 передней панели на задний порт ЛС RS-485 / RS-422.


# 01 - Read Coils

Количество флагов в одном запросе не должно превышать 64.

**Начальный адрес флага, передаваемого мастером в запросе, на 1 меньше реального адреса.**

| Адрес (dec) | Адрес (hex) | Описание          |
|:-----------:|:-----------:|:------------------|
| 201         | C9          | Неисправность     |
| 202         | CA          | Предупреждение    |


## 01 - Read Coils - Пример работы

```
TX: 01 01 00 C8 00 02 3C 35
RX: 01 01 01 01 90 48
```

Чтение двух флагов начиная с адреса 0xC9.


# 03 - Read Holding Registers

Количество регистров в одном запросе не должно превышать 32.

Адрес в запросе не должен превышать максимальный адрес в таблице.

Все не используемые регистры из таблицы начиная с 1 и заканчивая маскимальным адресом будут возвращать значение 0xFFFF.

**Начальный адрес регистра, передаваемого мастером в запросе, на 1 меньше реального адреса.**

| Адрес (dec) | Адрес (hex) | Описание                      | Значения              |
|:-----------:|:-----------:|:------------------------------|:----------------------|
| 1           | 1           | Год                           | 0 .. 99               |
| 2           | 2           | Месяц                         | 1 .. 12               |
| 3           | 3           | День                          | 1 .. 31               |
| 4           | 4           | Часы                          | 0 .. 23               |
| 5           | 5           | Минуты                        | 0 .. 59               |
| 6           | 6           | Секунды                       | 0 .. 59               |
| ---         | ---         | ---                           | ---                   |
| 10          | A           | Код неисправности Общий       | 0x0000 .. 0xFFFF [^1] |
| 11          | B           | Код предупреждения Общий      | 0x0000 .. 0xFFFF [^1] |
| ---         | ---         | ---                           | ---                   |
| 22          | 16          | Код неисправности защиты      | 0x0000 .. 0xFFFF [^1] |
| 23          | 17          | Код предупреждения защиты     | 0x0000 .. 0xFFFF [^1] |
| 24          | 18          | Режим работы Защиты           | 0 .. 5 [^1]           |
| 25          | 19          | Состояние защиты              | 0 .. 6 [^1]           |
| ---         | ---         | ---                           | ---                   |
| 123         | 7B          | Выходное напряжение, В        | 0 .. 999 [^2]         |
| 124         | 7C          | Выходной ток, мА              | 0 .. 999              |
| 125         | 7D          | Запас по затуханию Uk1/Uk, дБ | -99 .. 99             |
| 126         | 7E          | Запас по затуханию Uk2, дБ    | -99 .. 99             |
| ---         | ---         | ---                           |                       |
| 129         | 81          | Запас по затуханию Uз1/Uз, дБ | -99 .. 99             |
| 130         | 82          | Запас по затуханию Uз2, дБ    | -99 .. 99             |
| ---         | ---         | ---                           |                       |
| 156         | 9C          | Версия прошивки БСП MCU       | 0x0000 .. 0xFFFF [^3] |
| 157         | 9D          | Версия прошивки БСП DSP       | 0x0000 .. 0xFFFF [^3] |
| 158         | 9E          | Версия прошивки ПИ MCU        | 0x0000 .. 0xFFFF [^3] |
| ---         | ---         | ---                           | 0x0000 .. 0xFFFF [^3] |
| 163         | A3          | Версия прошивки БСП ПЛИС      | 0x0000 .. 0xFFFF [^3] |

[^1]: Коды неисправностей, предупреждений, режима и состояния приведены в РЭ часть 2.

[^2]: Выходное напряжение передается в 10 раз больше. Например 98 = 9.8В.

[^3]: Версия прошивки состоит из старшей и младшей версии. Например 0x0766 = 07.66.


## 03 - Read Holding Registers - Пример работы

```
TX: 01 03 00 09 00 0F D5 CC 
RX: 01 03 20 00 00 00 00 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 00 01 00 00 00 02 00 05 5C 82 
```

Чтение 16 регистров начиная с 0x0A.

```
TX: 01 03 00 9B 00 08 35 E3 
RX: 01 03 10 02 34 33 58 07 66 FF FF FF FF FF FF FF FF 0F 0F DD 81
```

Чтение 8 регистров начиная с 0x9С.
